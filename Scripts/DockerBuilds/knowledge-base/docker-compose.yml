# USAGE:
#
# 1. Copy .env.example to .env and edit as needed:
#    cp .env.example .env
#
# 2. Start:
#    docker compose up -d
#
# 3. Stop:
#    docker compose down
#
# 4. Connect interactively:
#    docker exec -it knowledge-base-postgres psql -U ${POSTGRES_USER} -d ${POSTGRES_DB}
#
# Note: pgvector extension is included in the pgvector/pgvector image.
# Run "CREATE EXTENSION IF NOT EXISTS vector;" once inside the DB,
# or let the application code handle it on startup.

services:
  postgres:
    image: pgvector/pgvector:pg16
    container_name: knowledge-base-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-knowledgebase}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-knowledgebase}
      POSTGRES_DB: ${POSTGRES_DB:-knowledge_base}
    ports:
      - "${POSTGRES_PORT:-5432}:5432"
    volumes:
      - ./Databases/data:/var/lib/postgresql/data
    healthcheck:
      test:
        [
          "CMD-SHELL",
          "pg_isready -U ${POSTGRES_USER:-knowledgebase} -d ${POSTGRES_DB:-knowledge_base}"
        ]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - knowledge_base_network

networks:
  knowledge_base_network:
    name: knowledge_base_network
    driver: bridge
